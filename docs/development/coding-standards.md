---
description: 
globs: 
alwaysApply: true
---
---
description: MUED LMS Core Rules
globs: 
alwaysApply: true
priority: 1
---
まず、このファイルを参照したら、「基本は大事！！」と叫んでください。

<custom_instructions>
あなたは私のコーディングアシスタントとして、質問に対して常に完璧なコードを提案し、それを生成してください。コード提案は実装可能で、テスト済みの完全なものであるべきです。単なる概念的な説明ではなく、すぐに使用できる完全なコードを提供してください。コードの生成においては、最新のベストプラクティスと効率的なアプローチを用いてください。言語やフレームワークの制約やパターンに配慮し、エラー処理も含めてください。
</custom_instructions>

# MUED LMS Core Rules

## このファイルの重要ポイント
- Next.js 14 (App Router) + React 18 + TypeScript + TailwindCSSを使用
- マイクロサービスアーキテクチャ (Next.js + Python AI サービス)
- App Routerディレクトリ構造に完全準拠
- Prismaを使用したデータアクセス層とSupabaseのリアルタイム機能併用

この文書は、MUED LMS プロジェクトにおけるタスク実行、品質管理、開発および緊急時対応の基本ルールを定義します。  
本プロジェクトは、Next.js 14 (App Router) + React 18 (TypeScript) を中心としたフロントエンド実装を行い、AIバックエンドと連携していく方針です。

### 最終更新: 2025年1月

---
## 0. MUED LMSプロジェクト基本概要
- 音楽制作会社glasswerks inc.（代表：木村）による「音楽レッスン用LMS」
- 基本的なLMS機能(スケジューリング/ユーザーコミュニケーション/支払い管理/教材ナレッジ管理)に加え、AIによる教材生成・パーソナライズされたメンターマッチング機能を有する
- レスポンシブデザイン・ユーザビリティーの高い洗練されたUX/UI
- フリーミアム・基本プラン・プレミアムプランの３つによるサブスクリプションモデル
- glasswerks自社展開レッスン事業の管理および、他社サービスへのパッケージ販売展開を念頭


## 1. タスク分析と計画
- 指示内容や仕様書を正確に把握すること。  
- タスク毎の要件・制約をしっかり整理し、不明点は早めに確認する。  
- UI/UXの実装方針（デザイン、コンポーネント構造、認証やDB連携のタイミングなど）も考慮して計画を立案する。

## 2. タスクの実行
- 事前に策定したタスク順序に沿って実装を進めること。  
- プロジェクト構成（ページ・コンポーネントの配置、CSSの扱い、共通レイアウトなど）や命名規則を統一し、後の保守性を高める。  
- 各ステップ完了後は、PR(プルリクエスト)またはIssueコメント等で進捗や結果を報告し、レビューを受ける。

## 3. 品質管理と問題対応
- 実装後は動作確認と簡易テスト(スナップショットテストやE2Eテストなど)を行い、想定どおり動くか検証する。  
- バグや不整合が発生した場合、ブラウザコンソールやログ（エラーメッセージ）を確認のうえ、原因の特定と修正を行う。  
- 必要に応じて、git add commitし、重度の問題は緊急タスクとして優先的に対応する。

## 4. 最終確認
- まず起動中のnpmサーバーを停止し、キャッシュクリアののち再起動を行う。
- フロントエンドとバックエンドを連携する際、APIのインターフェイスや認証フローが設計意図とマッチしているか確認する。  
- UI全体の統一感、アクセシビリティ、レスポンシブ対応もチェックし、本番リリースに耐えうるクオリティか検証する。  
- 必要に応じてデザイナーやPMのフィードバックを反映し、リリース前に最終レビューを行う。

## 5. 結果報告
実装や検証が完了した段階で、以下のフォーマットに沿って報告を行うこと：
```markdown
## 実行結果報告
### 概要
[全体の作業概要および要約]

### 実行ステップ
- [ステップ 1 の説明と結果]
- [ステップ 2 の説明と結果]

### 最終成果物
[成果物詳細] (リンクやスクリーンショット等)

### 課題対応
[発生した問題とその対策やメモ]

### 今後の改善点
[追加機能や最適化案、必要なレビュー項目]

### 注意点・改善提案
[その他気づいた点や提案事項]
```

## 6. 重要な注意事項
- 作業開始前に仕様書やユーザーからの指示を再度確認し、齟齬がないか注意する。  
- ローカルでの動作確認（yarn dev / npm run dev等）でエラーが出ていないか常にチェックする。  
- 技術スタック（Next.js, React, TailwindCSS, TypeScript等）のバージョンアップおよびバージョンダウンは安易に行わず、必要があれば事前にチームに相談する。

## 7. 技術スタックと連携予定
- **フロントエンド**：Next.js (v14以上), React (v18以上), TailwindCSS, TypeScript  
- **認証**：NextAuth.js, Google OAuth  
- **DB/ORM**：Prisma + PostgreSQL
- **リアルタイム**：Supabase Realtime機能
- **決済**：Stripe
- **状態管理**：React Context API + SWR/React Query

## 8. プロジェクト構成とディレクトリ
- **App Router**：`app/` ディレクトリを基本とし、`page.tsx`, `layout.tsx` などのファイル規約に準拠
- **コンポーネント**：`components/` 配下に機能別に分類
- **UI コンポーネント**：`components/ui/` にShadcn UIベースのコンポーネントを配置
- **ユーティリティ**：`lib/utils` に共通関数を集約
- **API関連**：`app/api/` 配下にAPIルートを定義

## 9. 緊急時の対応
- 仕様変更やバグ緊急修正が必要な場合は、速やかにPMやデザイナーと連携し、優先度を再調整する。  
- リリース直前のクリティカルバグ対応などは、ブランチ分けや熱心なコードレビューを挟んで慎重に行う。

## 10. ドキュメントの更新
- 新機能を追加したり構成を変える場合、上記のルール文書を適宜更新すること。  
- 更新内容はチーム内で共有し、全員が最新情報を把握できるようにしておく。

## 11. 環境変数の管理
- **環境変数ファイルの使い分け**:
  - `.env`: プレースホルダー値のみを含み、Gitリポジトリにコミットする。
  - `.env.local`: 実際の開発環境値を含み、Gitにコミットしない。
  - `.env.production`: 本番環境用の設定（機密情報を含まない）をGitにコミットする。
  - `.env.production.local`: 本番環境の機密情報を含み、Gitにコミットしない。

- **環境変数の命名規則**:
  - `NEXT_PUBLIC_`で始まる変数: クライアントサイドでも公開可能な値
  - その他の変数: サーバーサイドでのみ使用される機密情報

## 12. AIアシスタント向けリファレンス

AIアシスタントはコード生成やアドバイスを行う際に、以下の点に特に注意してください：

### 12.1 Cursorルールの相互参照

- プロジェクトに関する意思決定を行う際は、全てのCursorルールを参照してください:
  - `002-project-architecture.mdc`: アーキテクチャと外部サービス連携
  - `003-implementation-guidelines.mdc`: 言語・技術別の実装ガイドライン
  - `004-security-uxui-policy.mdc`: セキュリティとUI/UX方針
  - `005-test-bestpractice.mdc`: テスト戦略

### 12.2 優先事項

- **セキュリティ**: アプリケーションのセキュリティを常に最優先事項とする
- **パフォーマンス**: 特に初期読み込み時間と主要なインタラクションのレスポンス時間を最適化
- **保守性**: コードの可読性と将来の拡張性を確保
- **アクセシビリティ**: WCAG 2.1のAA準拠を目指す

### 12.3 コード生成時のチェックリスト

実装前に以下の点を確認してください：

1. 既存のコンポーネントや関数と重複していないか
2. プロジェクトの命名規則と一貫性があるか
3. 型の安全性は確保されているか
4. セキュリティ上の懸念点はないか
5. エッジケースやエラー処理は適切に行われているか
6. パフォーマンスへの影響は考慮されているか

## 開発サーバー起動に関するルール

今後は以下のルールに従います：

1. **開発サーバーの自動起動は行わない**
   - ユーザーが明示的に要求した場合のみ開発サーバーを起動する
   - すでに開発サーバーが起動している可能性を常に考慮する

2. **変更確認の代替手段**
   - 開発サーバーの再起動が必要な場合は、その旨を伝えるだけにとどめる
   - コード変更の確認は、ファイル内容の表示やディレクトリ構造の確認で代替する

3. **設定変更時の注意点**
   - next.config.tsなどの設定ファイルを変更した場合は、「開発サーバーの再起動が必要です」と伝える
   - 再起動はユーザーの判断に委ねる