# ダッシュボード予約状況機能 - 実装チェックリスト

## 概要
ダッシュボードにロール別（メンター/生徒）の予約状況カードを追加する実装作業のチェックリストです。

**実装期間目安**: 3-4日
**前提条件**: 既存の予約システム（slots-calendar, booking-calendar）が動作していること

---

## Phase 1: 準備作業（30分）

### 1.1 ディレクトリ構造の確認・作成

- [✅] **Task**: ダッシュボード用コンポーネントディレクトリの作成
  ```bash
  mkdir -p app/components/dashboard
  ```
  
- [✅] **確認**: 以下のディレクトリが存在することを確認
  ```
  app/components/dashboard/
  app/dashboard/
  app/api/reservations/
  app/api/lesson-slots/
  ```

### 1.2 型定義ファイルの作成

- [✅] **Task**: 共通型定義ファイル作成
  - **ファイル**: `app/components/dashboard/types.ts`
  - **内容**:
  ```typescript
  // ダッシュボード用の型定義
  export interface TodayScheduleData {
    totalSlots?: number;
    bookedSlots?: number;
    availableSlots?: number;
    upcomingReservations?: Array<{
      id: string;
      startTime: string;
      endTime: string;
      mentorName?: string;
      studentName?: string;
      status: string;
    }>;
  }

  export interface ReservationStatusData {
    pendingApproval?: number;
    approved?: number;
    confirmed?: number;
    available?: number;
  }

  export interface DashboardCardProps {
    userRole: string;
    userId?: string;
  }
  ```

- [✅] **確認**: TypeScriptエラーがないことを確認
  ```bash
  npx tsc --noEmit
  ```

---

## Phase 2: TodayScheduleCard コンポーネント実装（2時間）

### 2.1 基本コンポーネントファイル作成

- [✅] **Task**: TodayScheduleCard コンポーネント作成
  - **ファイル**: `app/components/dashboard/TodayScheduleCard.tsx`

- [✅] **確認**: コンポーネントがエラーなくコンパイルされることを確認

### 2.2 メンター用表示ロジック実装

- [✅] **Task**: メンター向けの今日のスケジュール表示を実装
  - **ファイル**: `app/components/dashboard/TodayScheduleCard.tsx`
  - **対象**: useEffect内のデータ取得処理を実装

- [✅] **Task**: メンター用表示部分を実装
  - **対象**: return文内のコンテンツ部分

- [ ] **確認**: ブラウザで表示確認（メンターアカウントでログイン）
  - 開発者ツール → Console → エラーがないことを確認
  - カードが表示されていることを確認

### 2.3 生徒用表示ロジック実装

- [✅] **Task**: 生徒向けの今日の予約表示を実装
  - **対象**: fetchTodaySchedule関数内にelse if分岐を追加

- [✅] **Task**: 生徒用表示部分を実装
  - **対象**: return文内のコンテンツ部分を置換

- [ ] **確認**: ブラウザで表示確認（生徒アカウントでログイン）

---

## Phase 3: ReservationStatusCard コンポーネント実装（1.5時間）

### 3.1 基本コンポーネント作成

- [✅] **Task**: ReservationStatusCard コンポーネント作成
  - **ファイル**: `app/components/dashboard/ReservationStatusCard.tsx`

- [✅] **確認**: TypeScriptエラーがないことを確認
- [ ] **確認**: 個別にコンポーネントが表示されることを確認

---

## Phase 4: ダッシュボード統合（1時間）

### 4.1 ダッシュボードページ修正

- [✅] **Task**: 既存のダッシュボードページに新コンポーネントを統合
  - **ファイル**: `app/dashboard/page.tsx`

- [ ] **確認**: ダッシュボードページにアクセスして新しいカードが表示されることを確認
- [ ] **確認**: レスポンシブ表示が正しく動作することを確認（PC/タブレット/モバイル）

### 4.2 エクスポート用インデックスファイル作成

- [✅] **Task**: コンポーネントのインデックスファイル作成
  - **ファイル**: `app/components/dashboard/index.ts`

- [✅] **Task**: ダッシュボードページのインポートを更新
  - **対象**: `app/dashboard/page.tsx`のインポート文を変更

---

## 現在の進捗状況: Phase 4.2 完了

**次のステップ**: Phase 5 - API調整・動作確認

**実装済み機能**:
- ✅ 基本的なコンポーネント構造
- ✅ 型定義とTypeScript対応
- ✅ メンター/生徒両方の表示ロジック
- ✅ ダッシュボードページへの統合

**残り作業**:
- ブラウザでの動作確認とテスト
- APIエラーハンドリングの確認
- レスポンシブデザインの検証

---

## Phase 5: API調整・動作確認（1時間）

### 5.1 API動作確認

- [ ] **Task**: 既存APIの動作確認とデバッグ
  - **対象**: `/api/lesson-slots`
  - **確認内容**:
    1. ブラウザの開発者ツール → Network タブ
    2. ダッシュボードを開く
    3. APIリクエストが正しく送信されているか確認
    4. レスポンスデータが期待通りか確認

- [ ] **Task**: 必要に応じてAPIパラメータ調整
  - **対象**: lesson-slotsのクエリパラメータ
  - **確認項目**:
    - `teacherId`パラメータが正しく設定されているか
    - 日付フィルタが動作しているか
    - レスポンス形式が期待通りか

### 5.2 エラーハンドリング確認

- [ ] **Task**: エラーケースの動作確認
  - **テストケース**:
    1. ネットワーク切断時の動作
    2. 不正なuserIdでのアクセス
    3. APIが500エラーを返す場合
    4. データが0件の場合

- [ ] **確認**: エラー時に適切なメッセージが表示されることを確認

---

## Phase 6: 最終確認・テスト（30分）

### 6.1 機能テスト

- [ ] **Task**: メンターアカウントでの動作確認
  - **確認項目**:
    - [ ] 今日のスロット数が正しく表示される
    - [ ] 予約済み/空きスロット数が正しく計算される
    - [ ] 承認待ち/承認済み/確定済み予約数が正しく表示される

- [ ] **Task**: 生徒アカウントでの動作確認
  - **確認項目**:
    - [ ] 今日の予約が正しく表示される
    - [ ] 時間とメンター名が正しく表示される
    - [ ] ステータス別の予約数が正しく表示される

### 6.2 UIテスト

- [ ] **Task**: レスポンシブデザインの確認
  - **確認端末**:
    - [ ] デスクトップ（1920px以上）
    - [ ] タブレット（768px-1024px）
    - [ ] モバイル（375px-768px）

- [ ] **Task**: 表示品質の確認
  - **確認項目**:
    - [ ] フォントサイズが適切
    - [ ] 色使いが統一されている
    - [ ] アイコンが正しく表示される
    - [ ] レイアウトが崩れていない

### 6.3 パフォーマンステスト

- [ ] **Task**: 読み込み速度の確認
  - **確認方法**: ブラウザ開発者ツール → Performance タブ
  - **確認項目**:
    - [ ] 初回読み込み時間 < 2秒
    - [ ] API レスポンス時間 < 1秒
    - [ ] 不要なリクエストが発生していない

---

## Phase 7: 追加改善（オプション）

### 7.1 リアルタイム更新対応

- [ ] **Task**: 既存の通知システムとの連携
  - **対象**: `useReservationNotifications`フックの活用
  - **実装箇所**: 各コンポーネントのuseEffect

### 7.2 キャッシュ最適化

- [ ] **Task**: SWRまたはReact Queryの導入検討
  - **目的**: データ取得の最適化とキャッシュ管理

---

## 完了チェック

### 全体確認

- [ ] **機能**: メンター/生徒それぞれで予約状況が正しく表示される
- [ ] **UI**: レスポンシブデザインが適切に動作する
- [ ] **パフォーマンス**: 読み込み速度が適切
- [ ] **エラーハンドリング**: エラー時の表示が適切
- [ ] **TypeScript**: 型エラーがない
- [ ] **Console**: JavaScriptエラーがない

### ドキュメント更新

- [ ] **Task**: README.mdに新機能の説明を追加
- [ ] **Task**: コンポーネント仕様書の作成（必要に応じて）

---

## 注意事項

1. **作業前のバックアップ**: 作業開始前に現在のコードをコミット
2. **段階的確認**: 各Phaseごとに動作確認を実施
3. **エラーログ**: 問題が発生した場合は開発者ツールのコンソールを確認
4. **ロール切り替え**: メンター/生徒アカウントの切り替えテストを忘れずに実施

## トラブルシューティング

### よくある問題と解決方法

1. **APIエラー**: ネットワークタブでリクエスト/レスポンスを確認
2. **データが表示されない**: コンソールログでデータ構造を確認
3. **TypeScriptエラー**: 型定義を確認し、必要に応じて修正
4. **スタイルが適用されない**: TailwindCSSクラス名を確認 