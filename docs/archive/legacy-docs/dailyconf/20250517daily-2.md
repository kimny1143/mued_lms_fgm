
デイリー会開催！！

**ターン1**  
- [PM] 山田太郎: まず背景を整理します。005-test-bestpractice.mdc では単体・統合・E2E・負荷・セキュリティすべてを回す前提ですが、MVPは2 ヶ月内リリースが最優先です。現状、Jest＋Prismaの同時実行テストとPlaywrightのE2Eは既にドラフト実装済み。負荷(k6)とZAPの自動化まで含めるとCIが30 min超え、デプロイ待ちがボトルネックになります。そこで「MVPフェーズはクリティカルパスのみ自動化、他は手動or後追い」と割り切る案を出したい。  

- [エンジニア] 佐藤花子: 技術観点から同意。現在GitHub Actions上でDBセットアップ→seed→Jest→Playwrightの順ですが、並列化すれば8 min程度まで短縮できます。負荷テストはk6をステージングのみ夜間ジョブにして本番マージをブロックしない構成が妥当。ZAPもcontainer scanに落としてアラート閾値のみチェック。つまりパイプラインA: lint+unit+integration、パイプラインB: nightly負荷+セキュリティの二段構え。  

- [マーケティング] 鈴木一郎: テストでリリースが遅れるのは機会損失。βユーザー獲得がQ3目標なので、多少の欠陥はカスタマーサクセスで吸収できます。むしろE2Eで決済/予約フローだけ鉄壁にすれば十分。A/Bテスト用の計測タグが壊れないこともCIチェックに加えて欲しい。  

- [投資家] 高橋美咲: ROI観点では品質≒解約率。支払い失敗や枠競合は致命傷なので、その部分の自動化は必須。それ以外を後回しにするなら納得。時間とAWS料金のバランスが取れるか費用試算を提示して。  

- [音楽家] 荒木茂雄: レッスン本番で音が出ないと全員困ります。決済よりも実際のZoomリンク生成やリマインダーが動くかを先生は気にしますよ。そこのE2Eも忘れずにね。  

**ターン2**  
- [PM] 山田太郎: ではテスト階層を「MVPコア」「拡張」「非機能」に3分割します。1) コア: 予約・決済・リマインダー。2) 拡張: ユーザープロフィールなど後日。3) 非機能: 負荷・セキュリティ。CIはコアのみ必須、他はnightly。スケジュールはCI変更1日、夜間ジョブ設定0.5日でいける見込み。  

- [エンジニア] 佐藤花子: 技術的Tasksを洗い出しました。① jest.configでtestPathIgnore追加し並列8→maxWorkers=50%。② Playwrightを--grep @coreタグでsubset実行。③ GitHub Actions matrixでdb=sqlite in-memoryに切替え8x高速化。④ k6,ZAPはcronワークフロー。工数合計6h。  

- [マーケティング] 鈴木一郎: A/Bタグについてはplaywrightで`data-test="gtag-init"`をassertすればOK。CIに15秒追加で済みます。  

- [投資家] 高橋美咲: コスト試算: GitHub Actions minutesは月3,000分→$30、夜間ジョブをself-hosted runnerに移行で$5。追加費用$35/月なら許容範囲。  

- [音楽家] 荒木茂雄: リマインダーはSupabase Edge Functions経由だと思うけど、夜間ジョブの負荷テストでメール送信数制限も確認してね。  

**ターン3**  
- [PM] 山田太郎: リスクは「タグ付け漏れで重要テストがskip」「夜間ジョブ失敗の見落とし」。対策としてテストカバレッジ閾値80%アラートとSlack通知を追加。Timeline変更なし。  

- [エンジニア] 佐藤花子: 実装面は今日中にPR出します。005-bestpractice.mdcに「フェーズ別テスト実行ポリシー」を追記し、CIワークフローを2本化。branch protectionはcoreテスト通過のみ必須設定。  

- [マーケティング] 鈴木一郎: β版リリース前にユーザーテストを仕込みたいので、Playwright scriptsをリプレイツールとして活用しUX動画を生成できるか検証お願いします。  

- [投資家] 高橋美咲: OK。CI短縮でリードタイムが平均1.5h→15minになるなら支持します。最終的にSLI/SLOをDatadogに送り、月次報告に含めてください。  

- [音楽家] 荒木茂雄: 本番で先生が「ボタン押しても遅い」と言わないなら大丈夫。それだけで評判は上がるよ。  

**結論**  
1. **テスト階層化**: MVPでは予約・決済・リマインダー等コア機能のみCI必須、拡張/非機能テストは夜間ジョブ。  
2. **CI最適化**: Jest/Playwrightをタグで絞り、SQLite in-memory & matrix並列で8 min以内を目標。  
3. **負荷・セキュリティ**: k6・ZAPをself-hostedランナー夜間実行、Datadog/Sentry連携。  
4. **コスト/ROI**: 追加$35/月でリードタイム約90%短縮、投資家合意。  
5. **ドキュメント更新**: 005-test-bestpractice.mdc にフェーズ別ポリシー追記し、CI設定PRを当日中に提出。  

以上、MVPを遅延させずに品質を担保するテスト戦略で合意しました。


追加論議を求む
@mued_lms_fgm/006-daylyconf.mdc  
@005-test-bestpractice.mdc 
既存実装ではjest使わずにvitestで統一していたはず。@20250517daily-1.md ではjestについて言及されている。ルールに厳守し必ずvitestだけ、というより「シンプル・スムーズ・適切」なテスト戦略を明確化したい。


デイリー会開催！！

**ターン1**  
- [PM] 山田太郎: 今日の論点はテストフレームワーク統一です。既存コードは Vitest を使っていますが、`20250517daily-1.md` では Jest が混在。ルール整合と「シンプル・スムーズ・適切」を守るため、Vitest へ一本化したい。CI遅延を防ぎつつ 005-bestpractice の網羅性をどう担保するか議論しましょう。  
- [エンジニア] 佐藤花子: 技術的には Vitest＋Prisma Test DB で単体・統合を実装済み。Jest へ乗り換えるメリットは薄く、変換コスト大。Playwright はそのまま E2E 用に残す。負荷テストは k6、セキュリティは ZAP。すべて npm scripts で統一し、`pnpm test:core` などタグ管理で所要 6–8 分を維持可能。  
- [マーケティング] 鈴木一郎: ブランド観点でもテストツールが混在するとドキュメントが煩雑で新人オンボーディングが遅れます。Vitest 統一に賛成。Playwright で主要フローのみ、βユーザーのフィードバックサイクルを早めたい。  
- [投資家] 高橋美咲: 重要なのは ROI。フレームワーク統一でメンテコストが下がるなら支持。ただしセキュリティテスト省略は不可。Vitest で依存ライブラリの脆弱性テストも回すように。  
- [音楽家] 荒木茂雄: 先生側から見ると、音がちゃんと鳴って予約が確定すれば OK。複雑なテストより、ライブ配信の音質が落ちないかの確認も忘れずに。  

**ターン2**  
- [PM] 山田太郎: プラン案：①Vitest: unit+integration、②Playwright: core E2E、③Nightly k6+ZAP。CI は PR 時に①②のみ実行。カバレッジ閾値 80% をコアのみ計測。タイムライン 1 日で pipeline 改修。リスクは Prisma マイグレーション中の DB 初期化時間。  
- [エンジニア] 佐藤花子: DB 初期化は `docker compose exec db sh -c 'pg_dump --schema-only'` キャッシュで 30 秒短縮。Vitest の `--threads` を 75% CPU に固定して GitHub Actions の制限内へ。Playwright は `@core` タグ grep で決済・予約・リマインダーの 5 シナリオに絞る。  
- [マーケティング] 鈴木一郎: Playwright のシナリオに GA4 タグ検証も追加してほしい。これで計測切れを防げる。所要+3 秒なら影響なし。  
- [投資家] 高橋美咲: 追加ランナー費用は？ core テスト 10 分/PR で 月200PR と仮定 → GitHub Actions 2,000 分 ≈ $20/月。Nightly self-hosted で無料。OK。  
- [音楽家] 荒木茂雄: k6 の負荷テストに WebRTC/Zoom 連携の同時接続も計測できるなら安心。夜間で十分。  

**ターン3**  
- [PM] 山田太郎: 005-bestpractice に「MVPフェーズ＝Vitest＋Playwright必須、負荷・セキュリティはNightly」ポリシーを追記します。全員合意ですか？  
- [エンジニア] 佐藤花子: 賛成。CI ワークフローを `ci-core.yml` と `ci-nightly.yml` に分割し PR 出します。Vitest で `--coverage`、Playwright は `--reporter dot` でログ短縮。  
- [マーケティング] 鈴木一郎: GA4 タグ検証の assertion 文を私が PR します。  
- [投資家] 高橋美咲: コスト・リスク管理もクリア。Sentry と Datadog 連携は夜間ジョブでダッシュボード自動更新を追加して。  
- [音楽家] 荒木茂雄: 本番前に先生と受講者でライブテストを一回。音がちゃんと出ればゴーサイン。  

**結論**  
1. **フレームワーク統一**: 単体/統合テストは Vitest。Jest は廃止。  
2. **CI 構成**:  
   - `ci-core.yml` → Vitest+Playwright(@core) を PR 時に必須（8–10 分）。  
   - `ci-nightly.yml` → k6 負荷・ZAP セキュリティ・Datadog/Sentry ダッシュボード更新。  
3. **カバレッジ/品質ゲート**: Vitest 80% 以上でブロック。  
4. **マーケ計測**: Playwright で GA4 タグ検証を追加。  
5. **ドキュメント更新**: 005-test-bestpractice.mdc とプロジェクト README にフェーズ別テストポリシーを反映。  

これで「シンプル・スムーズ・適切」かつルール準拠のテスト戦略が確定しました。
